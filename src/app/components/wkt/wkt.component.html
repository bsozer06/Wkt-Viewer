<div class="header">
  <h2 class="title">WKT Viewer</h2>
  <p class="subtitle">Visualize Well-Known Text geometries on the map</p>
</div>

<form [formGroup]="form" class="wkt-form">
  <div class="section-title">Quick Actions</div>
  <div class="toolbar">
    <div class="left">
      <button mat-stroked-button type="button" (click)="pasteSample('polygon')">
        Sample POLYGON
      </button>
      <button mat-stroked-button type="button" (click)="pasteSample('line')">
        Sample LINESTRING
      </button>
      <button mat-stroked-button type="button" (click)="pasteSample('point')">Sample POINT</button>
    </div>
    <div class="right">
      <button mat-button type="button" (click)="copyWktToClipboard()">Copy WKT</button>
      <button mat-button type="button" (click)="clearAll()">Clear</button>
      <button mat-button type="button" (click)="useMapSpatialReference()">Use Map SR</button>
    </div>
  </div>

  <div class="section-title">Import / Export</div>
  <div class="import-export-section">
    <div
      class="drop-zone"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      [class.drag-over]="isDragging"
    >
      <mat-icon>cloud_upload</mat-icon>
      <p>Drag & drop file here</p>
      <span class="file-types">Supports: .wkt, .geojson, .json</span>
      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        accept=".wkt,.geojson,.json,.txt"
        style="display: none"
      />
      <button mat-stroked-button type="button" (click)="fileInput.click()">
        <mat-icon>folder_open</mat-icon>
        Browse Files
      </button>
    </div>
    <div class="export-buttons">
      <button
        mat-raised-button
        color="primary"
        type="button"
        (click)="exportAsWkt()"
        [disabled]="form.invalid"
      >
        <mat-icon>download</mat-icon>
        Export as WKT
      </button>
      <button
        mat-raised-button
        color="accent"
        type="button"
        (click)="exportAsGeoJSON()"
        [disabled]="form.invalid"
      >
        <mat-icon>download</mat-icon>
        Export as GeoJSON
      </button>
    </div>
  </div>

  <div class="section-title">Input</div>

  <div class="grid">
    <mat-form-field appearance="outline" class="wkt-field">
      <mat-label>WKT</mat-label>
      <textarea
        matInput
        formControlName="wkt"
        cdkTextareaAutosize
        cdkAutosizeMinRows="8"
        cdkAutosizeMaxRows="18"
        placeholder="Example: POLYGON ((-10 46, -12 34, -14 20, -10 46))"
      ></textarea>
      <mat-hint align="start">Enter WKT geometry (POINT/LINESTRING/POLYGON)</mat-hint>
      <mat-hint align="end">{{ form.get('wkt')?.value?.length || 0 }} chars</mat-hint>
      <mat-error *ngIf="form.get('wkt')?.hasError('required')">WKT is required</mat-error>
    </mat-form-field>

    <mat-form-field
      appearance="outline"
      class="epsg-field"
      matTooltip="4326 = WGS84 (lat/lon), 3857 = Web Mercator"
    >
      <mat-label>EPSG</mat-label>
      <mat-select formControlName="epsg">
        <mat-option *ngFor="let opt of epsgOptions" [value]="opt.value">{{ opt.label }}</mat-option>
      </mat-select>
      <mat-hint align="start">Coordinate reference system</mat-hint>
      <mat-error *ngIf="form.get('epsg')?.hasError('required')">EPSG is required</mat-error>
    </mat-form-field>
  </div>
</form>
